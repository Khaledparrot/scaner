<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>QR Tool</title>
<link rel="manifest" href="manifest.json">

<style>
:root{
 --bg:#0f0f10;
 --card:#1b1b1d;
 --border:#2a2a2d;
 --text:#e5e5e5;
 --accent:#9a9a9a;
}

body{
 margin:0;
 background:var(--bg);
 color:var(--text);
 font-family:system-ui;
 text-align:center;
}

.container{
 max-width:420px;
 margin:auto;
 padding:15px;
}

.card{
 background:var(--card);
 border:1px solid var(--border);
 border-radius:14px;
 padding:15px;
 margin-bottom:18px;
}

h1{
 font-size:20px;
 font-weight:600;
 margin:10px 0 18px;
}

video{
 width:100%;
 border-radius:12px;
}

#scanResult,#genValue{
 margin-top:12px;
 font-size:14px;
 color:var(--accent);
 word-break:break-all;
}

input{
 width:100%;
 padding:12px;
 border-radius:10px;
 border:1px solid var(--border);
 background:#111;
 color:white;
 outline:none;
 margin-bottom:10px;
}

button{
 width:100%;
 padding:12px;
 border-radius:10px;
 border:none;
 background:#2b2b2f;
 color:white;
 font-weight:600;
}

button:active{ background:#3a3a3f; }

#qrcode{
 margin-top:10px;
 display:flex;
 justify-content:center;
}
</style>
</head>

<body>
<div class="container">

<h1>QR Tool</h1>

<!-- SCANNER -->
<div class="card">
<video id="video" autoplay playsinline></video>
<canvas id="canvas" hidden></canvas>
<div id="scanResult">Scan a QR code</div>
</div>

<!-- GENERATOR -->
<div class="card">
<input id="textInput" placeholder="Enter text to generate QR">
<button onclick="generateQR()">Generate</button>
<div id="qrcode"></div>
<div id="genValue"></div>
</div>

</div>

<script src="jsQR.js"></script>
<script src="qrcode.min.js"></script>

<script>
/* ---------- SCANNER ---------- */
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const scanResult=document.getElementById("scanResult");
let last="";

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(s=>{video.srcObject=s;requestAnimationFrame(scan)});

function scan(){
 if(video.readyState===video.HAVE_ENOUGH_DATA){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const img=ctx.getImageData(0,0,canvas.width,canvas.height);
  const code=jsQR(img.data,img.width,img.height);

  if(code && code.data!==last){
    last=code.data;
    scanResult.textContent=code.data;
    navigator.clipboard.writeText(code.data);
    if(navigator.vibrate) navigator.vibrate(100);
  }
 }
 requestAnimationFrame(scan);
}

/* ---------- GENERATOR ---------- */
let qr;

function generateQR(){
 const text=document.getElementById("textInput").value.trim();
 if(!text) return;

 document.getElementById("qrcode").innerHTML="";

 qr=new QRCode(document.getElementById("qrcode"),{
  text:text,
  width:220,
  height:220,
  colorDark:"#000000",
  colorLight:"#ffffff",
  correctLevel:QRCode.CorrectLevel.M
 });

 document.getElementById("genValue").textContent=text;
}

/* service worker */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
